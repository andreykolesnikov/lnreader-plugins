var e=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,l){function o(e){try{i(n.next(e))}catch(e){l(e)}}function s(e){try{i(n.throw(e))}catch(e){l(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}i((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,n,r,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(i){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(l=0)),l;)try{if(a=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,n=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){l=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){l.label=s[1];break}if(6===s[0]&&l.label<r[1]){l.label=r[1],r=s;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(s);break}r[2]&&l.ops.pop(),l.trys.pop();continue}s=t.call(e,l)}catch(e){s=[6,e],n=0}finally{a=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a,n=require("htmlparser2"),r=require("@libs/fetch"),l=require("@libs/novelStatus"),o=require("@libs/filterInputs"),s=function(){function s(){this.id="FWN.com",this.name="Free Web Novel",this.icon="multisrc/readnovelfull/fwn.com/icon.png",this.site="https://freewebnovel.com/",this.version="2.2.4",this.lastSearch=null,this.searchInterval=3400,this.filters={type:{label:"Novel Type",value:"sort/most-popular",options:[{label:"Most Popular",value:"sort/most-popular"},{label:"Latest Release",value:"sort/latest-release"},{label:"Latest Novels",value:"sort/latest-novel"},{label:"Completed Novels",value:"sort/completed-novel"},{label:"Chinese Novel",value:"sort/latest-release/chinese-novel"},{label:"Korean Novel",value:"sort/latest-release/korean-novel"},{label:"Japanese Novel",value:"sort/latest-release/japanese-novel"},{label:"English Novel",value:"sort/latest-release/english-novel"}],type:o.FilterTypes.Picker},genres:{label:"Genre",value:"",options:[{label:"All",value:""},{label:"Action",value:"genre/Action"},{label:"Adult",value:"genre/Adult"},{label:"Adventure",value:"genre/Adventure"},{label:"Comedy",value:"genre/Comedy"},{label:"Drama",value:"genre/Drama"},{label:"Eastern",value:"genre/Eastern"},{label:"Ecchi",value:"genre/Ecchi"},{label:"Fantasy",value:"genre/Fantasy"},{label:"Game",value:"genre/Game"},{label:"Gender Bender",value:"genre/Gender+Bender"},{label:"Harem",value:"genre/Harem"},{label:"Historical",value:"genre/Historical"},{label:"Horror",value:"genre/Horror"},{label:"Josei",value:"genre/Josei"},{label:"Martial Arts",value:"genre/Martial+Arts"},{label:"Mature",value:"genre/Mature"},{label:"Mecha",value:"genre/Mecha"},{label:"Mystery",value:"genre/Mystery"},{label:"Psychological",value:"genre/Psychological"},{label:"Reincarnation",value:"genre/Reincarnation"},{label:"Romance",value:"genre/Romance"},{label:"School Life",value:"genre/School+Life"},{label:"Sci-fi",value:"genre/Sci-fi"},{label:"Seinen",value:"genre/Seinen"},{label:"Shoujo",value:"genre/Shoujo"},{label:"Shounen Ai",value:"genre/Shounen+Ai"},{label:"Shounen",value:"genre/Shounen"},{label:"Slice of Life",value:"genre/Slice+of+Life"},{label:"Smut",value:"genre/Smut"},{label:"Sports",value:"genre/Sports"},{label:"Supernatural",value:"genre/Supernatural"},{label:"Tragedy",value:"genre/Tragedy"},{label:"Wuxia",value:"genre/Wuxia"},{label:"Xianxia",value:"genre/Xianxia"},{label:"Xuanhuan",value:"genre/Xuanhuan"},{label:"Yaoi",value:"genre/Yaoi"}],type:o.FilterTypes.Picker}}}return s.prototype.sleep=function(a){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,new Promise((function(e){return setTimeout(e,a)}))]}))}))},s.prototype.parseNovels=function(e){var t=this,r=[],l={},o=function(){if(l.name&&l.path){var e=l.name;if(l.extraInfo){var t=[];l.extraInfo.status&&t.push(l.extraInfo.status),l.extraInfo.chapters&&t.push(l.extraInfo.chapters),t.length>0&&(e+=" (".concat(t.join(", "),")"))}r.push({name:e,path:l.path,cover:l.cover})}l={}},s=[a.Idle],i=function(){return s[s.length-1]},u=function(e){return s.push(e)},c=function(){return s.length>1?s.pop():i()},h=new n.Parser({onopentag:function(e,n){var r=i(),s=n.class||"",c=n.id||"";if(r===a.Idle&&(s.includes("archive")||"col-content"===s||s.includes("ul-list1")||"list-page"===c)&&u(a.NovelList),i()!==a.Idle){if("img"===e){var h=n["data-src"]||n["data-cfsrc"]||n.src;h&&!h.includes("icon")&&(l.path&&l.name&&o(),l.cover=new URL(h,t.site).href)}if("h3"===e&&u(a.NovelName),r===a.NovelName&&"a"===e){var v=n.href;v&&(l.path&&l.name&&o(),l.path=new URL(v,t.site).pathname.substring(1),l.name=n.title||"")}s.includes("s2")||s.includes("full")?(u(a.Status),l.extraInfo=l.extraInfo||{}):(s.includes("s3")||s.includes("s1")||s.includes("chapter")||s.includes("chr-text"))&&(u(a.Chapter),l.extraInfo=l.extraInfo||{})}},ontext:function(e){var t=e.trim();if(t){var n=i();n!==a.NovelName||l.name?n===a.Status?(t.toLowerCase().includes("full")||t.toLowerCase().includes("completed"))&&(l.extraInfo.status="Completed"):n===a.Chapter&&(t.toLowerCase().includes("chapter")||t.match(/^\d+/)&&t.length<10)&&(l.extraInfo.chapters=t):l.name=t}},onclosetag:function(e){var t=i();t===a.NovelName&&"h3"===e?c():(t!==a.Status||"span"!==e&&"a"!==e&&"div"!==e)&&(t!==a.Chapter||"span"!==e&&"a"!==e&&"div"!==e)||c()}});return h.write(e),h.end(),o(),r},s.prototype.popularNovels=function(a,n){return e(this,arguments,void 0,(function(e,a){var n,l,o,s,i,u,c,h,v=a.filters,p=a.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:return n=(null===(c=null==v?void 0:v.type)||void 0===c?void 0:c.value)||"sort/most-popular",l=(null===(h=null==v?void 0:v.genres)||void 0===h?void 0:h.value)||"",o="","sort/most-popular"===(s=p?"sort/latest-novels":l||n)&&e>1?[2,[]]:(o="".concat(this.site).concat(s),e>1&&(o+="/".concat(e)),[4,(0,r.fetchApi)(o)]);case 1:if(!(i=t.sent()).ok)throw new Error("Could not reach site (".concat(i.status,")"));return[4,i.text()];case 2:return u=t.sent(),[2,this.parseNovels(u)]}}))}))},s.prototype.parseNovel=function(o){return e(this,void 0,void 0,(function(){var e,s,i,u,c,h,v,p,f,d,b,m,g,y,w,S,N,C,x=this;return t(this,(function(t){switch(t.label){case 0:return e=this.site+o,[4,(0,r.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return s=t.sent(),i={path:o,chapters:[]},u=[],c=[],h=[],v=null,p=[a.Idle],f=function(){return p[p.length-1]},d=function(e){return p.push(e)},b=function(){return p.length>1?p.pop():f()},m=new n.Parser({onopentag:function(e,t){var n,r,l,o=f();switch(e){case"div":switch(t.class){case"books":case"m-imgtxt":return void d(a.Cover);case"inner":case"desc-text":o===a.Cover&&b(),d(a.Summary)}"rating"===t.id&&(v=t["data-novel-id"]);break;case"img":if(o===a.Cover){var s=null!==(r=null!==(n=t.src)&&void 0!==n?n:t["data-cfsrc"])&&void 0!==r?r:t["data-src"];s&&(i.cover=new URL(s,x.site).href),t.title&&(i.name=t.title)}break;case"h3":o===a.Cover&&d(a.NovelName);break;case"br":o===a.Summary&&u.push("\n");break;case"ul":(null===(l=t.class)||void 0===l?void 0:l.includes("info-meta"))?d(a.Info):"idData"===t.id&&d(a.ChapterList);break;case"a":o===a.Genres?c.push(t.title||""):o===a.ChapterList&&t.href&&h.push({name:t.title||"",path:new URL(t.href,x.site).pathname.substring(1)})}},ontext:function(e){var t=e.trim();if(t)switch(f()){case a.NovelName:i.name=(i.name||"")+t;break;case a.Summary:u.push(e);break;case a.Info:var n=t.toLowerCase();n.includes("author:")?d(a.Author):n.includes("status:")?d(a.Status):n.includes("genre:")&&d(a.Genres);break;case a.Author:i.author=t,b();break;case a.Status:var r=t.toLowerCase();r.includes("ongoing")?i.status=l.NovelStatus.Ongoing:r.includes("hiatus")?i.status=l.NovelStatus.OnHiatus:r.includes("completed")?i.status=l.NovelStatus.Completed:i.status=l.NovelStatus.Unknown,b()}},onclosetag:function(e){var t=f();switch(e){case"div":t===a.Summary&&b();break;case"h3":t===a.NovelName&&b();break;case"ul":t!==a.Info&&t!==a.ChapterList||b()}}}),m.write(s),m.end(),i.summary=u.join("\n").trim(),i.genres=c.join(", "),i.chapters=h,v&&0===h.length?(g="".concat(this.site,"ajax/chapter-archive?novelId=").concat(v),[4,(0,r.fetchApi)(g)]):[3,5];case 3:return(y=t.sent()).ok?[4,y.text()]:[3,5];case 4:w=t.sent(),S=[],N={},(C=new n.Parser({onopentag:function(e,t){"a"===e&&t.href&&(N.path=new URL(t.href,x.site).pathname.substring(1),N.name=t.title||"",d(a.Chapter))},ontext:function(e){f()!==a.Chapter||N.name||(N.name=e.trim())},onclosetag:function(e){"a"===e&&f()===a.Chapter&&(N.path&&S.push(N),N={},b())}})).write(w),C.end(),i.chapters=S,t.label=5;case 5:return[2,i]}}))}))},s.prototype.parseChapter=function(l){return e(this,void 0,void 0,(function(){var e,o,s,i,u,c,h,v,p,f;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(this.site+l)];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),o=0,s=[],i=[a.Idle],u=function(){return i[i.length-1]},c=function(e){return i.push(e)},h=function(){return i.length>1?i.pop():u()},v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},p=function(e){return e.replace(/[&<>"']/g,(function(e){return v[e]}))},(f=new n.Parser({onopentag:function(e,t){var n=u(),r=t.class||"",l=t.id||"";if(n===a.Idle?(r.includes("txt")||"chr-content"===l||"chapter-content"===l||"article"===l)&&(c(a.Chapter),o="div"===e||"article"===e?1:0):n===a.Chapter?("div"!==e&&"article"!==e||o++,r.includes("unlock-buttons")||r.includes("ads")||l.includes("ads")?c(a.Hidden):"script"!==e&&"style"!==e||c(a.Script)):n===a.Hidden&&("div"!==e&&"article"!==e||o++),u()===a.Chapter){var i=Object.keys(t).map((function(e){return" ".concat(e,'="').concat(t[e].replace(/"/g,"&quot;"),'"')})).join("");s.push("<".concat(e).concat(i,">"))}},ontext:function(e){if(u()===a.Chapter){var t=e.replace(/Read more at freewebnovel\.com/gi,"").replace(/Visit freewebnovel\.com for more chapters\./gi,"");s.push(p(t))}},onclosetag:function(e){var t=u();t===a.Chapter&&s.push("</".concat(e,">")),t!==a.Script||"script"!==e&&"style"!==e||h(),t!==a.Hidden&&t!==a.Chapter||"div"!==e&&"article"!==e||(--o<=0?(t===a.Hidden&&h(),h(),c(a.Stopped)):t===a.Hidden&&1===o&&h())}})).write(e),f.end(),[2,s.join("")]}}))}))},s.prototype.searchNovels=function(a,n){return e(this,void 0,void 0,(function(){var e,n,l,o,s;return t(this,(function(t){switch(t.label){case 0:return e=new URLSearchParams({searchkey:a}),n="".concat(this.site,"search"),l={method:"POST",body:e.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"}},[4,(0,r.fetchApi)(n,l)];case 1:if(!(o=t.sent()).ok)throw new Error("Could not reach site (".concat(o.status,")"));return[4,o.text()];case 2:return s=t.sent(),[2,this.parseNovels(s)]}}))}))},s}();!function(e){e[e.Idle=0]="Idle",e[e.Info=1]="Info",e[e.Cover=2]="Cover",e[e.Author=3]="Author",e[e.Genres=4]="Genres",e[e.Status=5]="Status",e[e.Hidden=6]="Hidden",e[e.Summary=7]="Summary",e[e.Stopped=8]="Stopped",e[e.Chapter=9]="Chapter",e[e.ChapterList=10]="ChapterList",e[e.NovelName=11]="NovelName",e[e.NovelList=12]="NovelList",e[e.NovelDetails=13]="NovelDetails",e[e.Script=14]="Script"}(a||(a={}));var i=new s;exports.default=i;