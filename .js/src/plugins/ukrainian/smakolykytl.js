var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function l(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(l,u)}s((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=u(0),l.throw=u(1),l.return=u(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(u){return function(s){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;l&&(l=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/fetch"),o=require("@libs/novelStatus"),i=require("@libs/proseMirrorToHtml"),l=r(require("dayjs")),u=function(){function r(){this.id="smakolykytl",this.name="Смаколики",this.site="https://smakolykytl.site/",this.apiSite="https://api.smakolykytl.site/api/user",this.version="1.0.1",this.icon="src/uk/smakolykytl/icon.png"}return r.prototype.popularNovels=function(r,o){return t(this,arguments,void 0,(function(t,r){var o,i,l,u,s=r.showLatestNovels;return e(this,(function(t){switch(t.label){case 0:return o=s?"/updates":"/projects",[4,(0,n.fetchApi)(this.apiSite+o)];case 1:return[4,t.sent().json()];case 2:return i=t.sent(),l=[],null===(u=(null==i?void 0:i.projects)||(null==i?void 0:i.updates))||void 0===u||u.forEach((function(t){return l.push({name:t.title,cover:t.image.url,path:"titles/"+t.id})})),[2,l]}}))}))},r.prototype.parseNovel=function(r){return t(this,void 0,void 0,(function(){var t,i,u,s,a,c,p,h,d,v,f,y,b,m,j;return e(this,(function(e){switch(e.label){case 0:return t=r.split("/").pop(),[4,(0,n.fetchApi)(this.apiSite+"/projects/"+t)];case 1:return[4,e.sent().json()];case 2:return i=e.sent(),u={path:r,name:(null===(p=null==i?void 0:i.project)||void 0===p?void 0:p.title)||"",cover:null===(d=null===(h=null==i?void 0:i.project)||void 0===h?void 0:h.image)||void 0===d?void 0:d.url,summary:null===(v=null==i?void 0:i.project)||void 0===v?void 0:v.description,author:null===(f=null==i?void 0:i.project)||void 0===f?void 0:f.author,status:(null===(y=null==i?void 0:i.project)||void 0===y?void 0:y.status_translate.includes("Триває"))?o.NovelStatus.Ongoing:o.NovelStatus.Completed},(s=[null===(b=null==i?void 0:i.project)||void 0===b?void 0:b.genres,null===(m=null==i?void 0:i.project)||void 0===m?void 0:m.tags].flat().map((function(t){return null==t?void 0:t.title})).filter((function(t){return t}))).length&&(u.genres=s.join(", ")),a=[],[4,(0,n.fetchApi)(this.apiSite+"/projects/"+t+"/books")];case 3:return[4,e.sent().json()];case 4:return c=e.sent(),null===(j=null==c?void 0:c.books)||void 0===j||j.forEach((function(t){var e;return null===(e=null==t?void 0:t.chapters)||void 0===e?void 0:e.forEach((function(e){return a.push({name:t.title+" "+e.title,path:"read/"+e.id,releaseTime:(0,l.default)(e.modifiedAt).format("LLL"),chapterNumber:a.length+1})}))})),u.chapters=a,[2,u]}}))}))},r.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,o,l,u;return e(this,(function(e){switch(e.label){case 0:return t=r.split("/").pop(),[4,(0,n.fetchApi)(this.apiSite+"/chapters/"+t)];case 1:return[4,e.sent().json()];case 2:return o=e.sent(),l=JSON.parse((null===(u=null==o?void 0:o.chapter)||void 0===u?void 0:u.content)||"[]"),Array.isArray(l)?[2,(0,i.proseMirrorToHtml)(l)]:l&&"object"==typeof l&&Array.isArray(l.content)?[2,(0,i.proseMirrorToHtml)(l.content)]:[2,"string"==typeof l?l:""]}}))}))},r.prototype.searchNovels=function(r){return t(this,void 0,void 0,(function(){var t,o,i,l,u;return e(this,(function(e){switch(e.label){case 0:return[4,(0,n.fetchApi)(this.apiSite+"/projects")];case 1:return[4,e.sent().json()];case 2:return t=e.sent(),o=r.toLowerCase(),i=[],null===(u=null===(l=null==t?void 0:t.projects)||void 0===l?void 0:l.filter((function(t){var e=t.title,n=t.id;return e.toLowerCase().includes(o)||String(n)==r})))||void 0===u||u.forEach((function(t){return i.push({name:t.title,cover:t.image.url,path:"titles/"+t.id})})),[2,i]}}))}))},r}();exports.default=new u;